<dom-module id="cwn-region-selector">
  <template>
    <cwn-popup id="popup" style="z-index: 10000">
      <div class="popup-body" id="body"></div>
    </cwn-popup>
  </template>
</dom-module>

<script>
  Polymer({
    is : 'cwn-region-selector',

    ready : function() {
      this.$.popup.header = 'Select';
    },

    init : function(map, markerLayer) {
      this.map = map;
      this.markerLayer = markerLayer;
    },

    onClick : function(features) {
      this.features = features;
      this.renderFeatures();
      this.$.popup.show();
    },

    renderFeatures : function() {
      var table = '<table class="table">';

      for (var i = 0; i < this.features.length; i++) {
        var f = this.features[i];

        var type = '';
        if( f.geometry.type == 'Point' ) type = 'Node';
        else if( f.geometry.type == 'LineString' ) type = 'Link';
        else if( f.geometry.type == 'Polygon' ) type = 'Region';


        table +=
          '<tr>' +
            '<td>'+type+'</td>' +
            '<td style="text-align:center">'+
              (f.properties.prmname || f.properties.name || 'Region to Region') +
            '</td>' +
            '<td>'+
              (type == 'Region' ?
                '<a class="btn btn-link region" index="'+i+'">Expand</a>' :
                '<a class="btn btn-link" index="'+i+'" href="#info/'+f.properties.prmname+'">Info</a>') +
            '</td>'
          '</tr>';
      }

      this.$.body.innerHTML = table+'</table>';

      $(this.$.body)
        .find('a')
        .on('click', function(e){
          if( !$(e.currentTarget).hasClass('region') ) {
            this.$.popup.hide();
            return;
          }

          var index = parseInt(e.currentTarget.getAttribute('index'));
          var feature = this.features[index];

          if( feature.geometry.type == 'Polygon') {
            this.map.onRegionClick(feature.properties.id);
            this.$.popup.hide();
          } else {
            alert("Not implemented yet :(");
          }

        }.bind(this));
    }
  })
</script>
