<dom-module id="cwn-filters">
    <style>
        .cb-border {
            display:inline-block;
            padding:2px 2px 0 2px;
            border-radius:4px;
        }
        .showControls {
            -webkit-transform: translate3d(0, -1000px, 0);
            transform: translate3d(0, -1000px, 0);
            transition: all 250ms;
        }
        .showControls.show {
            -webkit-transform: translate3d(0, 0, 0);
            transform: translate3d(0, 0, 0);
        }
        .linkLegend {
          width: 100px;
          height: 25px;
          display: inline-block;
          margin: 10px;
          box-shadow: 0 0 5px black;
          vertical-align: middle;
        }
    </style>

    <template>
      <cwn-popup id="popup" style="z-index: 10000">
        <div class="popup-body" id="body">
            <div class="row" >
                <div class="col-md-10 col-md-offset-1">
                  <div class="form-horizontal">

                    <div class="form-group">
                      <label for="filter-input" class="col-sm-2 control-label">Filter</label>
                      <div class="col-sm-10">
                        <input type="text" id="filter-input" class="form-control" on-change="updateFilterText" on-keyup="onKeyUp" />
                        <p class="help-block">By name or description.</p>
                      </div>
                    </div>

                    <div class="form-group">
                        <label for="filter-types" class="col-sm-2 control-label">Types</label>
                        <div class="col-sm-10" id="filter-types">

                            <template is="dom-repeat" items="{{legendArr}}">
                              <div>
                                <label class="checkbox-inline">
                                    <input type="checkbox"
                                        name="[[item.name]]"
                                        checked="[[item.checked]]"
                                        on-change="_updateCheckbox" />

                                    <div class="cb-border">
                                        <cwn-app-icon width="[[item.iconSize]]" height="[[item.iconSize]]" type="[[item.name]]"></cwn-app-icon>
                                        <div style="vertical-align:top;display:inline-block;padding:2px 0 0 2px">[[item.name]]</div>
                                    </div>
                                </label>
                              </div>
                            </template>

                        </div>
                    </div>

                    <div class="form-group">
                        <label for="filter-types" class="col-sm-2 control-label">Link Legend</label>
                        <div class="col-sm-10">
                          <h4><div class="linkLegend" id="toSink"></div> Flow to Sink</h4>
                          <h4><div class="linkLegend" id="fromDemand"></div> Flow from Demand</h4>
                          <h4><div class="linkLegend" id="groundwaterToDemand"></div> Groundwater to Demand</h4>
                          <h4><div class="linkLegend" id="recharge"></div> Recharge</h4>
                          <h4><div class="linkLegend" id="region"></div> To/from a Region</h4>


                        </div>
                    </div>

                  </div>
                </div>
            </div>
        </div>
      </cwn-popup>
    </template>
</dom-module>

<script>
    Polymer({
        is : 'cwn-filters',

        ready : function() {
          this.legendArr = [];
          this.iconSize = 22;

          this.filters = {
              calibrationMode : true,
              oneStepMode : true,
              text : '',
          };

          this.$.toSink.style.backgroundColor = CWN.colors.darkCyan;
          this.$.fromDemand.style.backgroundColor = CWN.colors.red;
          this.$.groundwaterToDemand.style.backgroundColor = CWN.colors.lightGrey;
          this.$.recharge.style.backgroundColor = CWN.colors.green;
          this.$.region.style.backgroundColor = CWN.colors.orange;
        },

        setLegend : function(legend) {
          this.legend = legend;

          var tmp = [];
          for( var key in this.legend ) {
              this.filters[key.replace(' ','_').replace('-','_')] = true;
              tmp.push({
                  iconSize : this.iconSize,
                  name : key,
                  checked : true
              });
          }
          this.legendArr = tmp;
        },

        _updateCheckbox : function(e) {
            var name = e.currentTarget.getAttribute('name');
            var value = $(e.currentTarget).is(':checked');
            this.filters[name.replace(' ','_').replace('-','_')] = value;

            this.fire('update', this.filters);
        },

        show : function() {
          this.$.popup.show();
        },

        hide : function() {
          this.$.popup.hide();
        },

        setCalibrationMode : function(e) {
            this.filters.calibrationMode = $(e.currentTarget).is(':checked');
            this.fire('update', this.filters);
        },

        setOneStepMode : function(e) {
            this.filters.oneStepMode = $(e.currentTarget).is(':checked');
            this.fire('update', this.filters);
        },

        onKeyUp : function(e) {
            if( e.which != 13 ) return;
            this.updateFilterText(e);
        },

        updateFilterText : function(e) {
            this.filters.text = e.currentTarget.value;
            this.fire('update', this.filters);
        }
    });
</script>
